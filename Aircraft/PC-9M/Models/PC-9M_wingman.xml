<?xml version="1.0"?>
<!-- PC-9M Wingman
     Author: David Young, 2018
     Virtual wingman who will follow main simulator aircraft.
     
     Copy this file into the Models folder corresponding to 
     your aircraft, such as:
     $HOME/Library/Application\ Support/FlightGear/Aircraft/org.flightgear.fgaddon/Aircraft/PC-9M/Models
-->

<PropertyList include="PC-9M.xml">

	<nasal>
		<load>
			print("LOAD PC-9M wingman ", cmdarg().getPath());
			var self = cmdarg();
			<!--props.dump(self);-->
			
			<!-- engine n1 node to track engine power parameters -->
			var engine_n1 = self.getNode("engines/engine/n1", 1);
			<!-- track both L and R gear in case they operate independently -->
			var gear_position_left = self.getNode("gear/gear[0]/position-norm", 1);
			var gear_position_right = self.getNode("gear/gear[1]/position-norm", 1);
			
			<!-- update wingman with values from main simulator aircraft -->
			var update = func {
				engine_n1.setDoubleValue(getprop("/engines/engine/n1"));
				gear_position_left.setDoubleValue(getprop("/gear/gear/position-norm"));
				gear_position_right.setDoubleValue(getprop("/gear/gear/position-norm"));
				<!--
				props.dump(engine_n1);
				props.dump(gear_position);
				-->
				
				<!-- recursively update -->
				settimer(update, 0);
			}
			update();
			
		</load>

		<unload>
			print("UNLOAD PC-9M wingman ", cmdarg().getPath());
		</unload>
	</nasal>

</PropertyList>
